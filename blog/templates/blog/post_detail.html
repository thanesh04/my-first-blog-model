{% extends 'blog/base.html' %}

{% block content %}

<div class="container">

    <!-- Back Button -->
    <a href="/" class="btn btn-outline-secondary mb-4">
        <i class="bi bi-arrow-left"></i> Back
    </a>

    <!-- Post Card -->
    <div class="card p-5 shadow-lg border-0">

        <!-- Title -->
        <h1 class="mb-3">{{ post.title }}</h1>

        <!-- Date -->
        <p class="text-muted">
            <i class="bi bi-calendar-event"></i>
            {{ post.published_date|date:"F d, Y" }}
        </p>

        <hr>

        <!-- Content -->
        <div class="fs-5 lh-lg">
            {{ post.text|linebreaks }}
        </div>

        <hr>

        <!-- Author & Like Section -->
        <div class="d-flex justify-content-between align-items-center mt-3">

            <p class="mb-0">
                <strong>Author:</strong> {{ post.author }}
            </p>

            <div class="d-flex gap-2">

                <!-- Like Button -->
                <a href="{% url 'like_post' pk=post.pk %}" 
                   class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-heart-fill"></i>
                    {{ post.likes|default:"0" }}
                </a>

                <!-- Edit Button (Only if logged in) -->
                {% if user.is_authenticated %}
                    <a href="{% url 'post_edit' pk=post.pk %}" 
                       class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-pencil-fill"></i> Edit
                    </a>
                {% endif %}

            </div>

        </div>

    </div>


    <!-- ================= COMMENTS SECTION ================= -->

    <div class="card mt-5 p-4 shadow-sm border-0">

        <h4 class="mb-4">
            ðŸ’¬ Comments ({{ comments.count }})
        </h4>

        {% for comment in comments %}
            <div class="border rounded p-3 mb-3 bg-light">
                <div class="d-flex justify-content-between">
                    <strong>{{ comment.user.username }}</strong>
                    <small class="text-muted">
                        {{ comment.created_at|date:"M d, Y H:i" }}
                    </small>
                </div>
                <p class="mt-2 mb-0">{{ comment.content|linebreaks }}</p>
            </div>
        {% empty %}
            <p class="text-muted">No comments yet. Be the first to comment!</p>
        {% endfor %}

    </div>


    <!-- ================= ADD COMMENT FORM ================= -->

    <div class="card mt-4 p-4 shadow-sm border-0">

        {% if user.is_authenticated %}
            <h5>Add a Comment</h5>

            <form method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">
                    Post Comment
                </button>
            </form>

        {% else %}
            <p>
                You must 
                <a href="{% url 'login' %}" class="fw-bold">
                    login
                </a> 
                to post a comment.
            </p>
        {% endif %}

    </div>

</div>

{% endblock %}